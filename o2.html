<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veberöd pilot - O2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="main.css">
    <script src="https://cdn.plot.ly/plotly-2.2.0.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    


    <script>
        $(document).ready(function () {
            var param = "oxygendissolved";
            var paramheader = "Dissolved Oxygen";
            $('#paramHeader').html(paramheader);
            var url = 'https://europe-west3-vaquita-technologies.cloudfunctions.net/veberodpilottelemetry?stationid=10&maxlimit=100&param=' + param;
            console.log(url);
            $.ajax({
                url: url,
                success: function (data, status, xhr) {
                    var rows = JSON.parse(data);
                    var d = new Date(rows[0].date);
                    $('#valLL').html(d.toLocaleString());
                    $('#valVAL').html(rows[0].value.toFixed(2));

                    rows.map(d => {
                        d.date = new Date(d.date);
                        return d;
                    });
                    function unpack(rows, key) {
                        return rows.map(function (row) { return row[key]; });
                    }
                    dates = unpack(rows, 'date');
                    var maxDate = new Date(Math.max.apply(null, dates));
                    var minDate = new Date(Math.min.apply(null, dates));

                    var trace1 = {
                        type: "scatter",
                        mode: "lines",
                        name: param,
                        x: dates,
                        y: unpack(rows, 'value'),
                        line: { color: 'green' }
                    }
                    var layoutParam = {
                        autosize: true,
                        paper_bgcolor: 'rgba(0,0,0,1)',
                        plot_bgcolor: 'rgba(0,0,0,1)',
                        bordercolor: 'rgba(0,0,0,1)',
                        xaxis: {
                            autorange: true,
                            type: 'date',

                        },
                        yaxis: {
                            autorange: true,
                        },
                        font: {
                            color: "#FFFFFF"
                        },
                        margin: {
                            t: 0,
                            l: 70,
                            r: 70,
                            b: 50
                        },
                        showlegend: false,
                    };

                    Plotly.newPlot("plotDiv", [trace1], layoutParam, { responsive: true, editable: false });


                },
                error: function (jqXhr, textStatus, errorMessage) {
                    alert('Cannot access server!')
                }
            });

        });
    </script>
</head>

<body>

    <div class="mainheader valign-wrapper ">
        <a class="material-icons left homeicon" style="margin-left: 10px;margin-right: 30px;" href="index.html">home</a>
        Veberöd Pilot Data
    </div>
    <div class="valContainer ">

        <div class="paramHeader" id="paramHeader">
            Temperature
        </div>

        <div class="lastlogcontainer">
            <div class="lastlogheader">
                Last logged <span id="valVAL"></span> at
            </div>
            <span id="valLL" class="lastlog">
                2021-07-14 07:51:33
            </span>
        </div>

        <div class="plotdivcontainer" style="padding-bottom: 30px;">

            <div id="plotDiv" style="height: 100%;margin: 10px;"></div>
        </div>



        <div style="min-height: 200px;">

        </div>

    </div>



    <div class="mainfooter">
        Vaquita Technologies 2021
    </div>

</body>

</html>